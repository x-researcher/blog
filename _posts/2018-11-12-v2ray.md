---
title: V2Ray代理搭建
tags: v2ray proxy
date:   2018-11-12 12:00:00 +0800
key:	v2rayproxy
---
今年双11撸了一台搬瓦工特价机，重新搭了梯子，顺便记录下搭建流程，供网友参考。
梯子方案采用基于`Nginx`的`vmess+ws+tls`的`V2Ray`。

<!--more-->

---


## VPS购买
这些年用过的VPS也不少了，之前用过`DigitalOcean`、`Vultr`和`Linode`，后来因为性价比入了[搬瓦工](https://bwh8.net/index.php)，手里有一台19刀/年，每月1T流量的CN2GT传家宝，性价比已经很满意了。今年双11搬瓦工推出[特惠款](https://bwh8.net/cart.php?a=confproduct&i=0)，性价比超级无敌，没忍住撸了一台 :joy: :joy: :joy:

配置如下：

![](/photos/v2ray-vps.png)

进入`KiwiVM`后台，先关闭主机，然后`Insatll new OS`，选择带BBR的系统，`reload`

安装完成后，记下`IP地址`。

#### **Tips:**

我习惯开启`firewalld`，当然不是必须的。`KiwiVM`-`Root shell-basic` 打开命令行，输入指令：
~~~bash
systemctl enable firewalld
systemctl start firewalld
firewall-cmd --zone=public --permanent --add-port=443/tcp
firewall-cmd --zone=public --permanent --add-port=<$需要开启的端口>/tcp
firewall-cmd --reload
~~~


## 域名注册
我用的梯子是`V2Ray`，采用的方案是基于`Nginx`的`vmess+ws+tls`，这样的IP打开看到的是一个网页，很好地保护IP不被GFW检测而被屏蔽，所以我们需要申请一个域名，免费的[freenom](https://www.freenom.com/)即可。

域名注册后，添加一个A记录，`Target`处填入IP地址。

## 服务器搭建
### 1.开始搭建

前期工作准备完成后，开始搭建。为方便，我采用的是[一键化安装脚本](https://github.com/wulabing/V2Ray_ws-tls_bash_onekey)。

命令行执行以下指令，即可进入自动安装程序：
~~~bash
git clone https://github.com/wulabing/V2Ray_ws-tls_bash_onekey.git temp && cd temp && bash install.sh | tee v2log.txt
~~~
按照提示，输入`域名`，链接`端口（默认）`，`alterID（默认）`

出现下图时即安装成功，并把v2ray配置信息复制下来，用于本地客户端配置

![](/photos/v2ray-config.png)

#### **Tips:**
如果出现错误`SSL 证书生成失败`，可能是开启`firewalld`时忘记开启`80`端口:
```bash
firewall-cmd --zone=public --permanent --add-port=80/tcp
firewall-cmd --reload
```

### 2.开机启动
这时服务器的配置已完成，`v2ray`已可正常使用，但最好把`Nginx`和`V2ray`加入开启启动项，服务器宕机后重启机器即可自动运行Nginx和V2ray。

~~~bash
# 授权文件
chmod +x /etc/rc.local
chmod +x /etc/rc.d/rc.local
# 编辑文件
vi /etc/rc.local
~~~
点击i进入`vi`的编辑模式，输入下面代码：
~~~bash
systemctl start v2ray
systemctl start nginx
~~~
然后按`ESC`键，输入`:wq`保存并退出该文件，就完成了。

### 3.重启
命令行输入`reboot`，重启服务器，使一切配置生效。

### **Tips:**
这种配置已经能满足要求了，但网站只是一个静态网页，如果想充分利用VPS，可以搭建一个真实的blog，例如`Jekyll`，可以参考我的另一篇文章，[VPS搭建Jekyll静态博客](http://blog.xresearcher.com/2018/11/13/vps-install-jekyll.html)。
## 本地客户端配置
### 1.程序下载。
需要下载的程序有两个，[v2ray-core](https://github.com/v2ray/v2ray-core/releases)和[v2rayN](https://github.com/2dust/v2rayN/releases)。

然后解压，并把`V2rayN.exe`放在V2ray.exe的同级目录下，如图

![](/photos/v2ray-v2rayn.png)

### 2.参数配置
打开`v2rayN.exe`程序，开始配置。

`服务器`-`添加[Vmess]服务器`-然后输入v2ray的配置信息，一定要输入正确，否则无法连接！

![](/photos/v2ray-v2rayn-config.png)

配置完成后，即可成功连接。右侧的二维码方便与别人分享，以及方便手机客户端通过扫码导入配置文件。

### 3.PAC模式设置
上述配置配合浏览器插件`SwitchOmega`即可实现科学上网，为了方便我们还可以设置`PAC模式`。

`启用HTTP代理`，并切换为`PAC模式`。

后台运行的`V2rayN`图标上右键，按照下图设置即可。

![](/photos/v2ray-v2rayn-config-pac1.png)
![](/photos/v2ray-v2rayn-config-pac2.png)

### 4.客户端开机启动
创建V2rayN的`快捷方式`，然后放到启动文件夹下即可。

![](/photos/v2ray-v2rayn-startup.png)

**至此配置结束。尽情享受自由互联吧！**
