---
title: MTProxy代理搭建
tags: MTProxy Telegram proxy
date:   2018-11-12 18:00:00 +0800
key:	mtproxy
---
`MTProxy`是通讯软件`Telegram`的专用代理，虽然搭载`V2Ray`代理也可正常访问，但后台还要一直开着V2Ray，比较麻烦，而且V2Ray偶尔会断流。。。所以创建一个MTProxy专用代理非常有必要。而且只要端口不冲突同一台VPS上可以**同时开启**V2Ray和MTProxy代理。

<!--more-->

---


[MTProxy官网地址](https://github.com/TelegramMessenger/MTProxy)

搭建比较简单，按照官网步骤一步步来就好，所以引用官方的英文吧：

## Building
Install dependencies:
~~~bash
yum install openssl-devel zlib-devel
yum groupinstall "Development Tools"
~~~

Clone the repo:
~~~bash
git clone https://github.com/TelegramMessenger/MTProxy
cd MTProxy
~~~

To build, simply run `make`, the binary will be in `objs/bin/mtproto-proxy`:
~~~bash
make && cd objs/bin
~~~
If the build has failed, you should run `make clean` before building it again.

## Running
#### 1. Obtain a secret, used to connect to telegram servers.
```bash
curl -s https://core.telegram.org/getProxySecret -o proxy-secret
```
#### 2. Obtain current telegram configuration. It can change (occasionally), so we encourage you to update it once per day.
```bash
curl -s https://core.telegram.org/getProxyConfig -o proxy-multi.conf
```
#### 3. Generate a secret to be used by users to connect to your proxy.
```bash
head -c 16 /dev/urandom | xxd -ps
# 如果提示不识别xxd命令，可以安装vim
yum install vim-common
```
#### 4. Run `mtproto-proxy`:
```bash
./mtproto-proxy -u nobody -p 8888 -H 443 -S <secret> --aes-pwd proxy-secret proxy-multi.conf -M 1
```
#### **Tips**: 如果开启了`firewalld`，需要打开这个端口：
~~~bash
firewall-cmd --zone=public --permanent --add-port=<$需要开启的端口>/tcp
firewall-cmd --reload
~~~
#### 5. Generate the link with following schema: 
```
tg://proxy?server=SERVER_NAME&port=PORT&secret=SECRET
```

## Systemd example configuration
#### 1. Create systemd service file (it's standart path for the most Linux distros, but you should check it before):
```bash
vi /etc/systemd/system/MTProxy.service
```
#### 2. Edit this basic service (especially paths and params):
```bash

[Unit]
Description=MTProxy
After=network.target

[Service]
Type=simple
WorkingDirectory=/root/MTProxy
ExecStart=/root/MTProxy/objs/bin/mtproto-proxy -u nobody -p 8888 -H 3154 -S <secret> --aes-pwd /root/MTProxy/objs/bin/proxy-secret /root/MTProxy/objs/bin/proxy-multi.conf -M 1
Restart=on-failure

[Install]
WantedBy=multi-user.target

```
#### 3. Reload daemons:
```bash
systemctl daemon-reload
```
#### 4. Test fresh MTProxy service:
```bash
systemctl restart MTProxy.service
# Check status, it should be active
systemctl status MTProxy.service
```
#### 5. Enable it, to autostart service after reboot:
```bash
systemctl enable MTProxy.service
```
